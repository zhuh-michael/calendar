# 📝 产品需求文档 (PRD) - StarQuest V1.0

| 文档属性 | 内容 |
| :--- | :--- |
| **项目名称** | StarQuest (假期大冒险) |
| **版本号** | V1.0.0 (MVP + 增强特性) |
| **产品定位** | 面向家庭的、游戏化驱动的假期任务管理平台 |
| **用户角色** | 家长（管理员）、学员（玩家） |
| **技术栈** | FE: Vue3 / BE: Java / DB: SQLite |

---

## 1. 全局交互与信息架构 (IA)

### 1.1 登录/鉴权体系
*   **账号体系**：由于是家庭内部使用，简化注册流程。
    *   **管理员账号**：系统预设 `admin` / `password`（支持首次登录修改）。
    *   **子账号**：家长在后台直接创建孩子账号（用户名+简单密码/图形密码）。
*   **平台区分**：
    *   **家长端**：PC/Pad 适配，侧重数据看板与配置。
    *   **学员端**：Pad/Mobile 适配，全屏沉浸式，侧重交互与动画。

---

## 2. 详细功能说明：家长端 (Parent Portal)

### 2.1 仪表盘 (Dashboard)
*   **核心指标**：
    *   今日任务完成率（%）。
    *   孩子当前星星总余额。
    *   待审核任务数量（红点提示）。
*   **快捷入口**：发布任务、发奖金（人工加分）、兑换审批。

### 2.2 任务管理 (Mission Control)
*   **视图模式**：支持“日历视图”和“列表视图”切换。
*   **创建任务 (CRUD)**：
    *   **基础字段**：任务名称、关联孩子、执行时间、奖励星星数。
    *   **高级配置**：是否重复（每日/每周）、是否需要审核（是/否）。
*   **⭐ [新特性] 任务模板库 (Templates)**：
    *   **预设模板**：系统内置“寒假作息模板”（如：08:00 晨读、21:00 收拾书包）。
    *   **一键导入**：家长点击“使用模板”，选择日期范围，系统自动批量生成日程表。
    *   *价值*：解决家长“不知道怎么安排”的冷启动问题。

### 2.3 星星银行与商城 (Economy System)
*   **商品管理**：
    *   新增/编辑商品：商品图（支持上传或选系统图标）、名称、价格（星星）、库存。
    *   **特殊商品类型**：
        *   *实物奖*（如乐高）。
        *   *虚拟权益*（如看电视券）。
        *   *⭐ 盲盒券*（用于孩子端抽奖）。
*   **积分明细**：查看孩子每一笔星星的来源（任务）和去向（消费）。

### 2.4 报表中心 (Analytics)
*   **图表展示**：
    *   **勤奋度曲线**：近7天每日完成任务数量折线图。
    *   **财富分布**：累计获得星星 vs 累计消费星星（柱状图）。

---

## 3. 详细功能说明：学员端 (Kid's App)

**UI 设计规范**：大圆角卡片、高饱和度配色、拟物化图标、微交互动画。

### 3.1 登录与心情打卡 (Check-in)
*   **登录页**：点击自己的头像 -> 输入简单密码。
*   **⭐ [新特性] 每日心情 (Mood)**：
    *   登录成功后，全屏弹出：“今天心情怎么样？”
    *   选项：😄 开心、😐 一般、😡 生气、😭 难过。
    *   *交互*：选择后记录数据，并作为“日记”展示在家长端。

### 3.2 冒险主页 (Dashboard)
*   **顶部栏**：
    *   头像 + 昵称。
    *   **星星余额**（带有金币呼吸灯效）。
*   **今日任务流 (Task Stream)**：
    *   **待办区**：展示今日未完成任务卡片。
        *   *交互*：点击圆圈 ✅ -> 播放“烟花特效” + 音效 -> 任务卡片飞入“已完成”列表。
        *   *审核逻辑*：若任务需审核，变为“审核中”状态（灰色不可点）。
    *   **已完成区**：展示今日战果，显示累计今日获得的星星数。

### 3.3 补给站 (Reward Shop)
*   **货架展示**：网格展示家长上架的商品。
*   **购买逻辑**：
    *   **余额不足**：商品置灰，进度条显示（60/100）。
    *   **余额充足**：商品高亮，点击购买 -> 弹出二次确认 -> 扣除星星 -> 提示“请找爸爸妈妈兑换”。

### 3.4 ⭐ [新特性] 幸运屋 (Lucky House)
*   **功能入口**：主页右下角悬浮一个宝箱图标。
*   **盲盒机制**：
    *   **入场券**：每次抽奖消耗固定星星（如 20星）。
    *   **动画效果**：点击抽奖 -> 转盘转动 或 宝箱抖动开启光效。
    *   **奖池配置**（后端可配权重）：
        *   大吉：现金红包 / 大额星星包（概率 5%）。
        *   中吉：免做卡 / 电视券（概率 20%）。
        *   小吉：少量星星回血（概率 45%）。
        *   鼓励：一句名言 / 谢谢参与（概率 30%）。
    *   *价值*：作为“星星回收机制”，防止通货膨胀，增加娱乐性。

---

## 4. 技术实施方案 (Technical Specs)

### 4.1 数据结构设计 (Schema) - SQLite
我们需要重点关注以下几张表的设计：

1.  **Users**: `id, username, role (parent/kid), star_balance, avatar`
2.  **Tasks**: `id, title, kid_id, start_time, status (0:todo, 1:pending, 2:done), reward_stars, is_template`
3.  **Rewards**: `id, name, cost, stock, type (item/blindbox)`
4.  **Orders**: `id, kid_id, reward_id, status (0:applied, 1:delivered), create_time`
5.  **Transactions**: `id, user_id, amount (+/-), reason, create_time` (核心流水表，确保账目可追溯)
6.  **Mood_Log**: `id, kid_id, mood_type, create_time`

### 4.2 接口规范 (API Guidelines)
*   **POST /api/task/complete**
    *   逻辑：前端发起 -> 后端校验状态 -> (如果无需审核) 更新Task状态 + 插入Transaction记录 + 更新User余额 -> 返回最新余额。
    *   *注意*：加 `@Transactional` 注解，保证原子性。
*   **POST /api/shop/lucky-draw**
    *   逻辑：检查余额 -> 扣除入场费 -> 随机算法计算结果 -> 插入中奖记录 -> 返回中奖物品。

### 4.3 前端交互细节 (Vue)
*   **音效管理**：预加载 `success.mp3` (完成任务), `coin.mp3` (获得星星), `gacha.mp3` (抽奖)。
*   **组件库**：
    *   家长端：使用 **Element Plus** 或 **Ant Design Vue**（追求效率）。
    *   学员端：使用 **Vant UI** 或手写 CSS 样式（追求定制化童趣风格）。

---

## 5. 研发宣导重点 (Kick-off Talking Points)

请在项目启动会上，向研发团队强调以下几点：

1.  **关于 SQLite 的并发问题**：
    *   “虽然我们用的是 SQLite，但请把 Service 层当做 MySQL 来写。所有的写操作（特别是扣星星、任务状态流转）必须在 Java 层加锁或者严格的事务控制，防止孩子狂点屏幕导致多次扣费或多次加分。”
2.  **关于盲盒逻辑**：
    *   “盲盒的概率逻辑要写在后端（Java），不要写在前端（JS），防止‘聪明的孩子’修改前端代码必中大奖。我们要防备的是未来的极客。”
3.  **关于界面体验**：
    *   “家长端可以简陋，但孩子端必须**流畅**。动画不要卡顿，按钮反馈要及时。这是孩子愿不愿意用的关键。”

---
