<view class="lucky-house">
  <!-- é¡¶éƒ¨æ  -->
  <view class="header">
    <view class="user-info">
      <image
        src="{{userInfo.avatar ? apiBaseUrl + '/' + userInfo.avatar : '../images/default-avatar.png'}}"
        mode="aspectFill"
        class="user-avatar"
      ></image>
      <view class="user-details">
        <text class="user-name">{{userInfo.nickname}}</text>
        <view class="star-balance">
          <text class="star-icon">â­</text>
          <text class="star-count">{{userInfo.starBalance}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¹¸è¿å±‹ä¸»ä½“ -->
  <view class="lucky-section">
    <text class="lucky-title">ğŸ° å¹¸è¿å±‹</text>
    <text class="lucky-subtitle">æ¯æŠ½ä¸€æ¬¡æ¶ˆè€— {{drawCost}} é¢—æ˜Ÿæ˜Ÿï¼Œè¯•è¯•ä½ çš„è¿æ°”å§ï¼</text>
    <text class="lucky-probabilities">å¥–æ± æ¦‚ç‡ï¼šå¤§å‰ï¼ˆ5%ï¼‰ Â· ä¸­å‰ï¼ˆ20%ï¼‰ Â· å°å‰ï¼ˆ45%ï¼‰ Â· é¼“åŠ±ï¼ˆ30%ï¼‰</text>

    <!-- å®ç®±åŒºåŸŸ -->
    <view class="chest-area">
      <view
        class="treasure-chest {{isDrawing ? 'shaking' : ''}} {{showResult ? 'opened' : ''}}"
        bindtap="performDraw"
      >
        <view class="chest-lid {{showResult ? 'open' : ''}}">
          <text class="chest-emoji">ğŸ’</text>
        </view>
        <view class="chest-body">
          <text class="chest-emoji">ğŸ</text>
        </view>
        <view class="chest-glow" wx:if="{{!isDrawing && !showResult && canDraw}}"></view>
      </view>

      <!-- æ˜Ÿæ˜Ÿä¸è¶³æç¤º -->
      <view wx:if="{{!canDraw && !isDrawing}}" class="insufficient-stars">
        <text class="star-big">â­</text>
        <text class="insufficient-text">æ˜Ÿæ˜Ÿä¸è¶³</text>
        <text class="need-more">è¿˜éœ€ {{drawCost - userInfo.starBalance}} é¢—æ˜Ÿæ˜Ÿ</text>
      </view>

      <!-- æŠ½å¥–ä¸­åŠ¨ç”» -->
      <view wx:if="{{isDrawing}}" class="drawing-animation">
        <view class="sparkles">
          <text class="sparkle">âœ¨</text>
          <text class="sparkle">â­</text>
          <text class="sparkle">ğŸŒŸ</text>
          <text class="sparkle">âœ¨</text>
        </view>
        <text class="drawing-text">æ­£åœ¨æŠ½å¥–ä¸­...</text>
      </view>
    </view>

    <!-- æŠ½å¥–ç»“æœ -->
    <view wx:if="{{showResult}}" class="draw-result">
      <view class="result-card {{resultCardClass}}">
        <view class="result-icon">
          <text class="result-emoji">{{drawResult.emoji}}</text>
        </view>
        <text class="result-title">{{drawResult.title}}</text>
        <text class="result-description">{{drawResult.description}}</text>
        <view wx:if="{{drawResult.stars > 0}}" class="result-stars">
          <text class="star-icon">â­</text>
          <text>+{{drawResult.stars}}</text>
        </view>
      </view>

      <button class="continue-btn" bindtap="continueDrawing">
        ç»§ç»­æŠ½å¥– ({{drawCost}} æ˜Ÿæ˜Ÿ)
      </button>
    </view>

    <!-- æŠ½å¥–å†å² -->
    <view class="history-section">
      <text class="history-title">ğŸ“œ æŠ½å¥–è®°å½•</text>
      <view wx:if="{{drawHistory.length === 0}}" class="empty-history">
        <text class="history-empty-icon">ğŸ“‹</text>
        <text class="empty-text">è¿˜æ²¡æœ‰æŠ½å¥–è®°å½•</text>
      </view>
      <view wx:else class="history-list">
        <view
          wx:for="{{drawHistory}}"
          wx:key="id"
          wx:for-item="record"
          class="history-item"
        >
          <text class="history-emoji">{{record.resultEmoji}}</text>
          <view class="history-info">
            <text class="history-result">{{record.resultText}}</text>
            <text class="history-time">{{record.formattedTime}}</text>
          </view>
          <view wx:if="{{record.starsEarned > 0}}" class="history-stars">
            <text class="star-icon">â­</text>
            <text>+{{record.starsEarned}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å¯¼èˆªæ  -->
  <view class="bottom-nav">
    <view class="nav-item" bindtap="goToDashboard">
      <text class="nav-icon">ğŸ </text>
      <text>é¦–é¡µ</text>
    </view>
    <view class="nav-item" bindtap="goToShop">
      <text class="nav-icon">ğŸª</text>
      <text>å•†åº—</text>
    </view>
    <view class="nav-item active">
      <text class="nav-icon">ğŸ°</text>
      <text>å¹¸è¿å±‹</text>
    </view>
  </view>
</view>
